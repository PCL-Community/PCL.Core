<Project Sdk="Microsoft.NET.Sdk">
    <!-- 项目属性 -->
    <PropertyGroup>
        <AssemblyTitle>PCL.Core</AssemblyTitle>
        <AssemblyName>PCL.Core</AssemblyName>
        <Description>PCL Community 为 PCL 开发的启动器核心库</Description>
        <Company>PCL Community</Company>
        <Product>PCL.Core</Product>
        <Copyright>Copyright © PCL Community</Copyright>
        <AssemblyVersion>1.0.0.0</AssemblyVersion>
        <FileVersion>1.0.0.0</FileVersion>
    </PropertyGroup>
    <PropertyGroup>
        <Configuration Condition="'$(Configuration)' == ''">Debug</Configuration>
        <Platform Condition="'$(Platform)' == ''">AnyCPU</Platform>
        <Configurations>Debug;CI;Release;Beta</Configurations>
        <Platforms>AnyCPU;x64;ARM64</Platforms>
        <ProjectGuid>{A0C2209D-64FB-4C11-9459-8E86304B6F94}</ProjectGuid>
        <RootNamespace>PCL.Core</RootNamespace>
        <TargetFramework>net8.0-windows</TargetFramework>
        <UseWPF>true</UseWPF>
        <EnableWindowsTargeting>true</EnableWindowsTargeting>
        <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
        <LangVersion>13.0</LangVersion>
        <Nullable>enable</Nullable>
        <ErrorReport>prompt</ErrorReport>
        <WarningLevel>4</WarningLevel>
        <OutputPath>bin\$(Configuration)-$(Platform)\</OutputPath>
        <PlatformTarget>$(Platform)</PlatformTarget>
    </PropertyGroup>
    <!-- 构建配置 -->
    <PropertyGroup Condition="'$(Configuration)' == 'Debug' Or '$(Configuration)' == 'CI' Or '$(Configuration)' == 'DebugCI'">
        <DebugSymbols>true</DebugSymbols>
        <DebugType>full</DebugType>
        <Optimize>false</Optimize>
        <DefineConstants Condition="'$(Configuration)' == 'Debug'">DEBUG;TRACE</DefineConstants>
        <DefineConstants Condition="'$(Configuration)' == 'CI' Or '$(Configuration)' == 'DebugCI'">CI;TRACE</DefineConstants>
    </PropertyGroup>
    <PropertyGroup Condition="'$(Configuration)' == 'Beta' Or '$(Configuration)' == 'Release' Or '$(Configuration)' == 'Publish'">
        <DebugType>none</DebugType>
        <Optimize>true</Optimize>
        <DefineConstants Condition="'$(Configuration)' == 'Release'">RELEASE;PUBLISH</DefineConstants>
        <DefineConstants Condition="'$(Configuration)' == 'Beta'">BETA;PUBLISH</DefineConstants>
    </PropertyGroup>
    <!-- 通用引用 -->
    <ItemGroup>
        <PackageReference Include="Microsoft.CSharp" Version="4.7.0" />
        <PackageReference Include="System.Management" Version="8.0.0" />
        <PackageReference Include="Microsoft.Extensions.Http" Version="9.0.8" />
        <PackageReference Include="Polly" Version="8.6.2" />
        <PackageReference Include="SharpZipLib" Version="1.4.2" />
        <PackageReference Include="System.Text.Json" Version="9.0.7" />
        <PackageReference Include="LiteDB" Version="5.0.21" />
        <PackageReference Include="Microsoft.Toolkit.Uwp.Notifications" Version="7.1.3" />
    </ItemGroup>
    <!-- 信不过巨硬的智障代码，手动包含需要的文件 -->
    <PropertyGroup>
        <EnableDefaultItems>false</EnableDefaultItems>
        <EnableDefaultCompileItems>false</EnableDefaultCompileItems>
        <EnableDefaultEmbeddedResourceItems>false</EnableDefaultEmbeddedResourceItems>
        <EnableDefaultNoneItems>false</EnableDefaultNoneItems>
        <EnableDefaultApplicationDefinition>false</EnableDefaultApplicationDefinition>
        <EnableDefaultPageItems>false</EnableDefaultPageItems>
    </PropertyGroup>
    <ItemGroup>
        <Compile Include="**\*.cs" Exclude="bin\**;obj\**;publish\**;**\*.g.cs" />
        <Page Include="**\*.xaml" Exclude="bin\**;obj\**;publish\**" />
    </ItemGroup>
    <!-- 自定义代码生成目标 -->
    <Target Name="GenerateTypes" BeforeTargets="CoreCompile">
        <Message Text="Generating LifecycleServiceTypes class..." Importance="normal" />
        <Exec Command="pwsh -ExecutionPolicy Bypass -File &quot;$(MSBuildProjectDirectory)\App\LifecycleServiceTypesGenerator.ps1&quot; &quot;$(MSBuildProjectDirectory)&quot;"
              ContinueOnError="false" />
        <Message Text="Generating setup accessors..." Importance="normal" />
        <Exec Command="pwsh -ExecutionPolicy Bypass -File &quot;$(MSBuildProjectDirectory)\ProgramSetup\SetupAccessorGenerator.ps1&quot; &quot;$(MSBuildProjectDirectory)&quot;"
              ContinueOnError="false" />
        <Message Text="Generating environment secrets..." Importance="normal" />
        <Exec Command="pwsh -ExecutionPolicy Bypass -File &quot;$(MSBuildProjectDirectory)\Utils\OS\EnvironmentInteropGenerator.ps1&quot; &quot;$(MSBuildProjectDirectory)&quot;"
              ContinueOnError="false" />
        <ItemGroup>
            <Compile Include="**\*.g.cs" Exclude="bin\**;obj\**;publish\**" />
        </ItemGroup>
    </Target>
</Project>